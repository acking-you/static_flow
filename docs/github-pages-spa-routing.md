# GitHub Pages SPA è·¯ç”±é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

## ğŸ“‹ é—®é¢˜æè¿°

åœ¨å°† Yew WASM å•é¡µåº”ç”¨ï¼ˆSPAï¼‰éƒ¨ç½²åˆ° GitHub Pages åï¼Œé‡åˆ°ç»å…¸çš„è·¯ç”±åˆ·æ–° 404 é—®é¢˜ï¼š

### å¤ç°æ­¥éª¤

1. è®¿é—®ä¸»é¡µï¼š`https://acking-you.github.io` âœ… æ­£å¸¸
2. é€šè¿‡å¯¼èˆªè¿›å…¥å…¶ä»–é¡µé¢ï¼š`https://acking-you.github.io/latest` âœ… æ­£å¸¸
3. **åœ¨ `/latest` é¡µé¢åˆ·æ–°æµè§ˆå™¨** âŒ **404 é”™è¯¯**
4. ç›´æ¥è®¿é—®æˆ–åˆ†äº« `/latest` é“¾æ¥ âŒ **404 é”™è¯¯**

### é—®é¢˜è¡¨ç°

```
GET https://acking-you.github.io/latest
â†’ GitHub Pages: 404 Not Found
```

## ğŸ” æ ¹æœ¬åŸå› 

### å®¢æˆ·ç«¯è·¯ç”± vs æœåŠ¡å™¨ç«¯è·¯ç”±çš„å†²çª

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å•é¡µåº”ç”¨ï¼ˆSPAï¼‰å·¥ä½œåŸç†                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. æ‰€æœ‰è·¯ç”±ç”±å‰ç«¯ JavaScriptï¼ˆYew Routerï¼‰å¤„ç†                â”‚
â”‚  2. å®é™…ä¸Šåªæœ‰ä¸€ä¸ª HTML æ–‡ä»¶ï¼ˆindex.htmlï¼‰                      â”‚
â”‚  3. /latestã€/postsã€/article/123 éƒ½æ˜¯"è™šæ‹Ÿè·¯ç”±"               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GitHub Pages æœåŠ¡å™¨è¡Œä¸º                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç”¨æˆ·è¯·æ±‚ï¼š/latest                                             â”‚
â”‚  æœåŠ¡å™¨æŸ¥æ‰¾ï¼š                                                  â”‚
â”‚    - /latest ç›®å½•ï¼Ÿ âŒ ä¸å­˜åœ¨                                  â”‚
â”‚    - /latest.html æ–‡ä»¶ï¼Ÿ âŒ ä¸å­˜åœ¨                             â”‚
â”‚    - /latest/index.htmlï¼Ÿ âŒ ä¸å­˜åœ¨                           â”‚
â”‚  ç»“æœï¼šè¿”å› 404 Not Found                                      â”‚
â”‚                                                               â”‚
â”‚  é—®é¢˜ï¼šå‰ç«¯ JavaScript è¿˜æ²¡æœ‰æœºä¼šè¿è¡Œå°±è¢« 404 é˜»æ­¢äº†ï¼           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸ºä»€ä¹ˆä»ä¸»é¡µå¯¼èˆªæ­£å¸¸ï¼Ÿ

```javascript
// ä»ä¸»é¡µç‚¹å‡»é“¾æ¥åˆ° /latest
// 1. index.html å·²åŠ è½½ï¼ŒYew åº”ç”¨å·²è¿è¡Œ
// 2. Yew Router æ‹¦æˆªç‚¹å‡»äº‹ä»¶
// 3. é€šè¿‡ history.pushState() æ”¹å˜ URLï¼ˆä¸å‘æœåŠ¡å™¨å‘è¯·æ±‚ï¼‰
// 4. æ¸²æŸ“å¯¹åº”ç»„ä»¶
// âœ… å…¨ç¨‹ä¸ç»è¿‡æœåŠ¡å™¨ï¼Œçº¯å®¢æˆ·ç«¯æ“ä½œ

// ç›´æ¥è®¿é—®æˆ–åˆ·æ–° /latest
// 1. æµè§ˆå™¨å‘æœåŠ¡å™¨è¯·æ±‚ /latest
// 2. æœåŠ¡å™¨æ‰¾ä¸åˆ°æ–‡ä»¶ï¼Œè¿”å› 404
// âŒ JavaScript æ— æ³•æ‰§è¡Œ
```

## âœ… è§£å†³æ–¹æ¡ˆ

### æ ¸å¿ƒæ€è·¯ï¼š404.html é‡å®šå‘ Hack

åˆ©ç”¨ GitHub Pages çš„ç‰¹æ€§ï¼š**å½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶ï¼Œä¼šè‡ªåŠ¨è¿”å›æ ¹ç›®å½•çš„ `404.html`ï¼Œä½†ä¿æŒåŸå§‹ URL ä¸å˜**ã€‚

### å®ç°æ­¥éª¤

#### 1. åˆ›å»º 404.html æ•è·å¹¶ä¿å­˜åŸå§‹ URL

**æ–‡ä»¶ä½ç½®ï¼š** `frontend/404.html`ï¼ˆä¸ `index.html` åŒçº§ï¼‰

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Redirecting...</title>
    <script>
        // GitHub Pages SPA Router Hack
        // æ•è·å½“å‰è·¯å¾„å¹¶é‡å®šå‘åˆ° index.html

        // è·å–å®Œæ•´è·¯å¾„ï¼ˆè·¯å¾„ + æŸ¥è¯¢å‚æ•° + hashï¼‰
        var path = window.location.pathname;
        var search = window.location.search;
        var hash = window.location.hash;

        // ä¿å­˜åˆ° sessionStorageï¼ˆåªåœ¨å½“å‰æ ‡ç­¾é¡µæœ‰æ•ˆï¼‰
        sessionStorage.setItem('redirectPath', path + search + hash);

        // é‡å®šå‘åˆ°æ ¹è·¯å¾„
        window.location.replace('/');
    </script>
</head>
<body>
    <p>Redirecting to app...</p>
</body>
</html>
```

**å…³é”®è®¾è®¡ï¼š**
- âœ… ä½¿ç”¨ `sessionStorage`ï¼šåªåœ¨å½“å‰æ ‡ç­¾é¡µæœ‰æ•ˆï¼Œå…³é—­åè‡ªåŠ¨æ¸…é™¤
- âœ… ä½¿ç”¨ `window.location.replace()`ï¼šä¸ç•™å†å²è®°å½•ï¼Œé¿å…æ— é™å¾ªç¯
- âŒ ä¸ä½¿ç”¨ `localStorage`ï¼šä¼šæ±¡æŸ“å…¶ä»–æ ‡ç­¾é¡µ
- âŒ ä¸ä½¿ç”¨ Query Stringï¼šä¼šæš´éœ²åœ¨ URLï¼Œå½±å“åˆ†äº«é“¾æ¥

#### 2. ä¿®æ”¹ index.html æ¢å¤åŸå§‹ URL

**æ–‡ä»¶ä½ç½®ï¼š** `frontend/index.html`ï¼ˆåœ¨ `<head>` æœ€å‰é¢æ·»åŠ ï¼‰

```html
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>StaticFlow</title>

    <!-- GitHub Pages SPA Router: æ¢å¤åŸå§‹ URL -->
    <script>
      (function() {
        var redirectPath = sessionStorage.getItem('redirectPath');
        if (redirectPath) {
          sessionStorage.removeItem('redirectPath');  // æ¸…ç†
          history.replaceState(null, '', redirectPath);  // æ¢å¤ URL
        }
      })();
    </script>

    <!-- å…¶ä»–å†…å®¹... -->
</head>
```

**å…³é”® APIï¼š**
```javascript
history.replaceState(null, '', '/latest');
// 1. ä¿®æ”¹æµè§ˆå™¨åœ°å€æ å’Œå†å²è®°å½•
// 2. ä¸è§¦å‘é¡µé¢é‡æ–°åŠ è½½ï¼ˆä¸å‘æœåŠ¡å™¨å‘è¯·æ±‚ï¼‰
// 3. Yew Router ä¼šè¯»å–æ–° URL å¹¶æ¸²æŸ“å¯¹åº”é¡µé¢
```

#### 3. é…ç½® Trunk å’Œ GitHub Actions

**é—®é¢˜ï¼š** Trunk ä¼šå°† `static/` ç›®å½•ä¸‹çš„æ–‡ä»¶å¤åˆ¶åˆ° `dist/static/`ï¼Œè€Œ GitHub Pages åªè¯†åˆ«æ ¹ç›®å½•çš„ `404.html`ã€‚

**å°è¯•è¿‡çš„æ–¹æ¡ˆï¼ˆå‡å¤±è´¥ï¼‰ï¼š**
- âŒ `[[copy]]` æŒ‡ä»¤ï¼šTrunk ä¸æ”¯æŒ
- âŒ `[[assets]]` æŒ‡ä»¤ï¼šåªå¯¹ index.html å¼•ç”¨çš„èµ„æºæœ‰æ•ˆ
- âŒ `post_build` hookï¼šä¼šè¢« "applying new distribution" æ­¥éª¤è¦†ç›–

**æœ€ç»ˆæ–¹æ¡ˆï¼šåœ¨ GitHub Actions ä¸­æ‰‹åŠ¨å¤åˆ¶**

**Trunk.tomlï¼š**
```toml
# ä¸éœ€è¦é¢å¤–é…ç½®ï¼Œ404.html æ”¾åœ¨ frontend/ æ ¹ç›®å½•å³å¯
```

**GitHub Actions workflowï¼ˆ`.github/workflows/deploy.yml`ï¼‰ï¼š**
```yaml
- name: Build frontend (production)
  working-directory: frontend
  run: trunk build --release

- name: Copy 404.html to dist root (GitHub Pages SPA routing)
  working-directory: frontend
  run: cp 404.html dist/404.html  # æ‰‹åŠ¨å¤åˆ¶åˆ° dist æ ¹ç›®å½•

- name: Deploy to User Pages (acking-you.github.io)
  uses: peaceiris/actions-gh-pages@v3
  with:
    personal_token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
    external_repository: acking-you/acking-you.github.io
    publish_dir: frontend/dist
```

## ğŸ“Š å®Œæ•´æµç¨‹å›¾

```
ç”¨æˆ·åˆ·æ–° /latest é¡µé¢
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: æµè§ˆå™¨è¯·æ±‚                                            â”‚
â”‚ GET https://acking-you.github.io/latest                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: GitHub Pages æŸ¥æ‰¾æ–‡ä»¶                                 â”‚
â”‚ - æŸ¥æ‰¾ /latest â†’ ä¸å­˜åœ¨                                       â”‚
â”‚ - è§¦å‘ 404 å¤„ç†é€»è¾‘                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: GitHub Pages ç‰¹æ®Šè¡Œä¸º                                 â”‚
â”‚ è¿”å›æ ¹ç›®å½•çš„ 404.html                                         â”‚
â”‚ HTTP 200 OKï¼ˆä¸æ˜¯ 404 çŠ¶æ€ç ï¼‰                                 â”‚
â”‚ URL æ ä»ç„¶æ˜¾ç¤ºï¼š/latest                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: 404.html æ‰§è¡Œ                                        â”‚
â”‚ var path = window.location.pathname; // "/latest"           â”‚
â”‚ sessionStorage.setItem('redirectPath', '/latest');          â”‚
â”‚ window.location.replace('/');                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: é‡å®šå‘åˆ°æ ¹è·¯å¾„                                        â”‚
â”‚ GET https://acking-you.github.io/                           â”‚
â”‚ â†’ GitHub Pages è¿”å› index.html                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: index.html æ¢å¤ URL                                  â”‚
â”‚ var redirectPath = sessionStorage.getItem('redirectPath');  â”‚
â”‚ history.replaceState(null, '', '/latest');                  â”‚
â”‚ â†’ URL æ å˜å›ï¼š/latest                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7: Yew åº”ç”¨å¯åŠ¨                                          â”‚
â”‚ - Yew Router è¯»å– URLï¼š/latest                               â”‚
â”‚ - åŒ¹é…è·¯ç”±è§„åˆ™                                                â”‚
â”‚ - æ¸²æŸ“ LatestArticlesPage ç»„ä»¶                               â”‚
â”‚ âœ… ç”¨æˆ·çœ‹åˆ°æ­£ç¡®çš„é¡µé¢                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§ª éªŒè¯æ–¹æ³•

### æœ¬åœ°æµ‹è¯•

1. æ„å»ºå¹¶å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨
```bash
cd frontend
trunk build
python3 -m http.server 8000 --directory dist
```

2. è®¿é—® `http://localhost:8000/latest`ï¼ˆç›´æ¥è®¿é—®ï¼Œä¸ä»ä¸»é¡µå¯¼èˆªï¼‰
   - âŒ æœŸæœ›ï¼šæ˜¾ç¤º 404.html çš„ "Redirecting to app..." ç„¶åè·³è½¬
   - âœ… ä¿®å¤åï¼šç›´æ¥æ˜¾ç¤ºæ­£ç¡®é¡µé¢

### æµè§ˆå™¨æ§åˆ¶å°éªŒè¯

```javascript
// åœ¨ /latest é¡µé¢æ‰“å¼€æ§åˆ¶å°

// æ£€æŸ¥å½“å‰è·¯å¾„
console.log(window.location.pathname);  // "/latest"

// æ£€æŸ¥ sessionStorageï¼ˆæ­£å¸¸æƒ…å†µåº”è¯¥ä¸ºç©ºï¼‰
console.log(sessionStorage.getItem('redirectPath'));  // null

// æ‰‹åŠ¨è§¦å‘ 404 é‡å®šå‘æµç¨‹ï¼ˆæ¨¡æ‹Ÿåˆ·æ–°ï¼‰
sessionStorage.setItem('redirectPath', '/latest');
window.location.replace('/');
// â†’ é¡µé¢ä¼šé‡æ–°åŠ è½½å¹¶æ¢å¤åˆ° /latest
```

### ç”Ÿäº§ç¯å¢ƒéªŒè¯

1. æ¨é€ä»£ç åˆ° master åˆ†æ”¯
2. ç­‰å¾… GitHub Actions éƒ¨ç½²å®Œæˆ
3. æµ‹è¯•åœºæ™¯ï¼š
   - âœ… ç›´æ¥è®¿é—® `https://acking-you.github.io/latest`
   - âœ… åœ¨ `/latest` é¡µé¢åˆ·æ–°æµè§ˆå™¨ï¼ˆCtrl+R / Cmd+Rï¼‰
   - âœ… åœ¨ `/latest` é¡µé¢å¼ºåˆ¶åˆ·æ–°ï¼ˆCtrl+Shift+Rï¼‰
   - âœ… åˆ†äº« `/latest` é“¾æ¥ç»™ä»–äºº

## ğŸ“‚ æœ€ç»ˆç›®å½•ç»“æ„

**æºç ï¼š**
```
frontend/
â”œâ”€â”€ index.html          â† Trunk å…¥å£ï¼ˆåŒ…å« URL æ¢å¤è„šæœ¬ï¼‰
â”œâ”€â”€ 404.html           â† GitHub Pages SPA è·¯ç”±å¤„ç†
â”œâ”€â”€ Trunk.toml
â”œâ”€â”€ src/
â””â”€â”€ static/
    â”œâ”€â”€ avatar.jpg
    â”œâ”€â”€ styles.css
    â””â”€â”€ ...
```

**æ„å»ºäº§ç‰©ï¼ˆéƒ¨ç½²åˆ° GitHub Pagesï¼‰ï¼š**
```
dist/
â”œâ”€â”€ index.html                    â† ä¸»åº”ç”¨
â”œâ”€â”€ 404.html                     â† âœ… åœ¨æ ¹ç›®å½•ï¼
â”œâ”€â”€ static-flow-*.js              â† WASM glue code
â”œâ”€â”€ static-flow-*_bg.wasm         â† WASM äºŒè¿›åˆ¶
â””â”€â”€ static/
    â”œâ”€â”€ avatar.jpg
    â”œâ”€â”€ styles.css
    â””â”€â”€ ...
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ä¸è¦ç¦ç”¨ JavaScript

è¿™ä¸ªæ–¹æ¡ˆä¾èµ– JavaScriptï¼š
- 404.html éœ€è¦æ‰§è¡Œ JS ä¿å­˜è·¯å¾„
- index.html éœ€è¦æ‰§è¡Œ JS æ¢å¤ URL

å¦‚æœç”¨æˆ·ç¦ç”¨ JavaScriptï¼Œä¼šå¡åœ¨ 404.html é¡µé¢ã€‚

### 2. é¦–æ¬¡åŠ è½½ä¼šæœ‰çŸ­æš‚é—ªçƒ

```
ç”¨æˆ·è§†è§’ï¼š
/latest â†’ "Redirecting to app..." (é—ªç°) â†’ æ­£ç¡®é¡µé¢

å®é™…æµç¨‹ï¼š
/latest â†’ 404.html â†’ / â†’ index.html â†’ æ¢å¤åˆ° /latest
```

é—ªçƒæ—¶é—´é€šå¸¸ < 100msï¼Œç”¨æˆ·å¯èƒ½æ„Ÿè§‰ä¸åˆ°ã€‚

### 3. SEO å½±å“

- **ä¸å½±å“**ï¼šGoogle Bot ä¼šæ‰§è¡Œ JavaScript
- **ä¸å½±å“**ï¼šæœ€ç»ˆ URL æ˜¯æ­£ç¡®çš„ï¼ˆ/latestï¼‰
- **ä¸å½±å“**ï¼šHTTP çŠ¶æ€ç æ˜¯ 200ï¼ˆä¸æ˜¯ 404ï¼‰

### 4. sessionStorage çš„ä½œç”¨åŸŸ

- âœ… åŒä¸€æ ‡ç­¾é¡µæœ‰æ•ˆ
- âŒ ä¸è·¨æ ‡ç­¾é¡µ
- âŒ å…³é—­æ ‡ç­¾é¡µåå¤±æ•ˆ

è¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„è¡Œä¸ºï¼šé¿å…æ±¡æŸ“å…¶ä»–æ ‡ç­¾é¡µã€‚

## ğŸ†š å…¶ä»–æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|----------|
| **404.html hack** | ç®€å•ï¼Œæ— éœ€æœåŠ¡å™¨é…ç½® | é¦–æ¬¡åŠ è½½é—ªçƒï¼Œéœ€è¦ JS | GitHub Pagesï¼ˆæ¨èï¼‰ |
| **HashRouter (#/latest)** | å®Œå…¨å®¢æˆ·ç«¯ï¼Œæ— æœåŠ¡å™¨è¯·æ±‚ | URL å¸¦ `#` ä¸ç¾è§‚ï¼ŒSEO ä¸å‹å¥½ | å¿«é€ŸåŸå‹ |
| **æœåŠ¡å™¨é…ç½®** | å®Œç¾ä½“éªŒï¼Œæ— é—ªçƒ | GitHub Pages ä¸æ”¯æŒ | è‡ªæ‰˜ç®¡æœåŠ¡å™¨ |
| **Netlify _redirects** | åŸç”Ÿæ”¯æŒï¼Œé›¶é…ç½® | ä¸é€‚ç”¨äº GitHub Pages | Netlify éƒ¨ç½² |
| **Vercel é…ç½®** | åŸç”Ÿæ”¯æŒï¼Œé›¶é…ç½® | ä¸é€‚ç”¨äº GitHub Pages | Vercel éƒ¨ç½² |

### GitHub Pages ä¸æ”¯æŒçš„æ–¹æ¡ˆ

**ä¸ºä»€ä¹ˆä¸èƒ½ç”¨æœåŠ¡å™¨é…ç½®ï¼Ÿ**

ç†æƒ³çš„æœåŠ¡å™¨é…ç½®ï¼ˆNginx/Apacheï¼‰ï¼š
```nginx
# Nginx
location / {
    try_files $uri $uri/ /index.html;
}

# Apache (.htaccess)
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  RewriteRule ^index\.html$ - [L]
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /index.html [L]
</IfModule>
```

**ä½†æ˜¯ï¼š**
- âŒ GitHub Pages ä¸å…è®¸è‡ªå®šä¹‰æœåŠ¡å™¨é…ç½®
- âŒ æ— æ³•ä¸Šä¼  `.htaccess` æˆ– `nginx.conf`
- âŒ æ— æ³•ä¿®æ”¹æœåŠ¡å™¨è¡Œä¸º

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼š404.html ä¸ç”Ÿæ•ˆ

**æ£€æŸ¥æ¸…å•ï¼š**
```bash
# 1. ç¡®è®¤ 404.html åœ¨ dist æ ¹ç›®å½•
ls -la frontend/dist/ | grep 404
# åº”è¯¥çœ‹åˆ°ï¼š-rw-r--r-- ... 404.html

# 2. ç¡®è®¤ GitHub Actions å¤åˆ¶æ­¥éª¤å­˜åœ¨
cat .github/workflows/deploy.yml | grep "404"
# åº”è¯¥çœ‹åˆ°ï¼šcp 404.html dist/404.html

# 3. æ£€æŸ¥éƒ¨ç½²åçš„æ–‡ä»¶
# è®¿é—® https://acking-you.github.io/404.html
# åº”è¯¥çœ‹åˆ° "Redirecting to app..."
```

### é—®é¢˜ 2ï¼šæ— é™é‡å®šå‘å¾ªç¯

**åŸå› ï¼š** 404.html æˆ– index.html çš„è„šæœ¬æœ‰é—®é¢˜

**æ£€æŸ¥ï¼š**
```javascript
// 404.html åº”è¯¥æœ‰ï¼š
sessionStorage.setItem('redirectPath', path + search + hash);
window.location.replace('/');  // â† ç¡®ä¿é‡å®šå‘åˆ° /

// index.html åº”è¯¥æœ‰ï¼š
if (redirectPath) {
  sessionStorage.removeItem('redirectPath');  // â† ç¡®ä¿æ¸…ç†
  history.replaceState(null, '', redirectPath);
}
```

### é—®é¢˜ 3ï¼šåˆ·æ–°åæ˜¾ç¤ºä¸»é¡µè€Œä¸æ˜¯ç›®æ ‡é¡µé¢

**åŸå› ï¼š** Yew Router é…ç½®é—®é¢˜æˆ– URL æ¢å¤è„šæœ¬ä½ç½®é”™è¯¯

**æ£€æŸ¥ï¼š**
1. URL æ¢å¤è„šæœ¬å¿…é¡»åœ¨ `<head>` æœ€å‰é¢ï¼ˆåœ¨æ‰€æœ‰å…¶ä»– script ä¹‹å‰ï¼‰
2. Yew Router é…ç½®æ­£ç¡®ï¼š
```rust
#[derive(Debug, Clone, Copy, PartialEq, Routable)]
pub enum Route {
    #[at("/")]
    Home,
    #[at("/latest")]
    LatestArticles,
    // ...
}
```

## ğŸ“š å‚è€ƒèµ„æ–™

- [GitHub Pages å®˜æ–¹æ–‡æ¡£](https://docs.github.com/en/pages)
- [Single Page Apps for GitHub Pages](https://github.com/rafgraph/spa-github-pages)
- [Yew Router æ–‡æ¡£](https://yew.rs/docs/concepts/router)
- [MDN: History API](https://developer.mozilla.org/en-US/docs/Web/API/History_API)
- [MDN: Window.sessionStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage)

## ğŸ¯ æ€»ç»“

é€šè¿‡ **404.html é‡å®šå‘ hack**ï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº† GitHub Pages ä¸Šçš„ SPA è·¯ç”±åˆ·æ–°é—®é¢˜ï¼š

1. âœ… ç”¨æˆ·å¯ä»¥ç›´æ¥è®¿é—®ä»»æ„è·¯ç”±
2. âœ… åˆ·æ–°é¡µé¢ä¸ä¼š 404
3. âœ… åˆ†äº«é“¾æ¥æ­£å¸¸å·¥ä½œ
4. âœ… æµè§ˆå™¨å†å²è®°å½•æ­£å¸¸
5. âœ… SEO å‹å¥½ï¼ˆURL æ­£ç¡®ï¼ŒçŠ¶æ€ç  200ï¼‰
6. âœ… ç®€å•å®ç°ï¼ˆ2 ä¸ªè„šæœ¬ + 1 è¡Œ GitHub Actionsï¼‰

è™½ç„¶æœ‰çŸ­æš‚é—ªçƒï¼Œä½†å¯¹äºå…è´¹çš„ GitHub Pages æ‰˜ç®¡æ¥è¯´ï¼Œè¿™æ˜¯æœ€ä½³è§£å†³æ–¹æ¡ˆï¼
