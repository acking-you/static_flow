# Static Flow Frontend

This crate contains the Yew-based client for the Static Flow experience. It renders the blog shell, theme toggles, article detail pages, tag/category listings, and shared layout in WebAssembly so the UI can stay extremely fast while consuming static or API-provided content.

## Development Environment

- **Rust** stable toolchain (1.75+ recommended)
- **wasm32-unknown-unknown** target: `rustup target add wasm32-unknown-unknown`
- **Trunk** CLI for bundling and serving (`cargo install trunk`)
- Optional: a local API on `http://localhost:3000` if you want the proxy in `Trunk.toml` to forward requests during development

## Common Commands

```bash
# Start the development server with automatic rebuilds
trunk serve

# Create an optimized production bundle in dist/
trunk build --release

# Format Rust code
cargo fmt

# Lint with Clippy (fail on warnings by default)
cargo clippy -- -D warnings
```

## Directory Structure

```
frontend/
├── Cargo.toml           # Rust crate definition and dependencies
├── Trunk.toml           # Trunk build/serve configuration
├── index.html           # HTML entry point that bootstraps the Wasm bundle
├── static/
│   ├── styles.css       # Global styles, themes, and responsive layout rules
│   └── ...              # Favicons, images, and static assets copied during build
├── src/
│   ├── main.rs          # App entry point and root app initialization
│   ├── router.rs        # Yew Router route definitions
│   ├── i18n/            # Centralized UI copy and locale selection
│   │   ├── mod.rs       # Locale switch + template helpers
│   │   └── zh_cn.rs     # Chinese copy bundle (current default)
│   ├── models.rs        # Shared data structures for posts, tags, etc.
│   ├── utils.rs         # Small helpers (storage, formatting, etc.)
│   ├── components/      # Header, footer, theme toggle, article card, ...
│   └── pages/           # Home, article detail, tags, categories, not-found views
└── target/              # Generated by Cargo/Trunk (ignored in VCS)
```

## Workflow & Notes

1. Run `trunk serve` in watch mode for local development. The proxy defined in `Trunk.toml` can forward API calls to a backend at `localhost:3000` so the UI behaves closer to production.
2. Keep `cargo fmt` and `cargo clippy -- -D warnings` clean before pushing to ensure CI parity.
3. Static assets go in `static/` and will be copied directly into the final `dist/` bundle.

## Current Progress & TODO

**Done**
- Responsive shell with sticky/fixed header, mobile navigation, and dark-mode toggle
- API-driven article list/detail, tags, categories, search, image search, and related-article rendering
- Article detail toolbar actions (language switch, quick brief, copy raw markdown, trend panel)
- Article image lightbox with zoom in/out/reset controls
- Article view analytics integration:
  - enter article detail => call `POST /api/articles/:id/view` (backend 10s dedupe)
  - show total views near article header
  - open trend panel from left action button and render day/hour line chart
  - support hour mode with specific day selection (`YYYY-MM-DD`)

**Next up**
- Add component/integration tests for trend panel state transitions (`day`/`hour`, day selector, error states)
- Improve chart accessibility (keyboard focus, richer aria labels, screen-reader value summaries)
- Add visual-regression coverage for article detail overlays (brief modal, image lightbox, trend dialog)

## Article View Analytics Flow

1. Route enters article detail page (`/posts/:id`).
2. Frontend fetches article content, then calls `POST /api/articles/:id/view`.
3. Response returns `total_views`, `today_views`, and `daily_points` (timezone: `Asia/Shanghai`).
4. Header view badge uses `total_views`; trend button opens overlay chart.
5. Overlay can request `GET /api/articles/:id/view-trend?granularity=day&days=30` or `granularity=hour&day=YYYY-MM-DD`.

## UI Copy & Localization

- All user-facing frontend copy is centralized in `src/i18n/`.
- Current active locale is `i18n::current` (currently aliased to `zh_cn`).
- To add another language later:
  1. Add a new locale file (for example `en_us.rs`) under `src/i18n/`.
  2. Keep key/module structure aligned with `zh_cn.rs`.
  3. Switch `pub use zh_cn as current;` in `src/i18n/mod.rs` to the target locale.
- Dynamic copy templates use `fill_one` / `fill_two` helpers in `src/i18n/mod.rs`.
